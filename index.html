<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML代码预览器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/dracula.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #f1f1f1;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, #00dbde, #fc00ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: #aaa;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .code-panel {
            flex: 1;
            min-width: 300px;
            background: #1e1e2e;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        
        .panel-header {
            background: #252537;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #333;
        }
        
        .panel-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .html-icon {
            background: #e34c26;
        }
        
        .css-icon {
            background: #264de4;
        }
        
        .js-icon {
            background: #f0db4f;
            color: #323330;
        }
        
        .preview-icon {
            background: #3c873a;
        }
        
        .code-container {
            height: 400px;
            overflow: hidden;
        }
        
        .CodeMirror {
            height: 100% !important;
            font-size: 16px;
            padding: 10px 0;
        }
        
        .preview-panel {
            flex: 1;
            min-width: 300px;
            background: #f8f9fa;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
        }
        
        .preview-header {
            background: #252537;
            padding: 15px 20px;
            border-bottom: 2px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .preview-content {
            flex: 1;
            padding: 20px;
            background: white;
            overflow: auto;
            color: #333;
        }
        
        .controls-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            margin-top: 20px;
        }
        
        .controls-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #00dbde;
            text-align: center;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #00dbde, #0093E9);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, #8e2de2, #4a00e0);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(90deg, #56ab2f, #a8e063);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(90deg, #f46b45, #eea849);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .status-bar {
            background: rgba(0, 0, 0, 0.4);
            padding: 12px 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .status-indicator.active {
            background: #4CAF50;
        }
        
        .status-indicator.inactive {
            background: #f44336;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .code-panel, .preview-panel {
                width: 100%;
            }
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #888;
            font-size: 0.9rem;
        }
        
        .tab-container {
            display: flex;
            background: #1a1a2e;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .tab.active {
            background: #00dbde;
            color: #1a1a2e;
        }
        
        .tab:not(.active):hover {
            background: rgba(0, 219, 222, 0.2);
        }
        
        /* 开关样式 */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #4CAF50;
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        
        .realtime-control {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }
        
        .preview-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .preview-controls button {
            padding: 8px 16px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>HTML代码预览器</h1>
            <p class="subtitle">在左侧输入HTML、CSS和JavaScript代码，右侧实时查看预览效果。使用下方控制面板管理您的代码。</p>
        </header>
        
        <div class="tab-container">
            <div class="tab active" id="tab-html">HTML</div>
            <div class="tab" id="tab-css">CSS</div>
            <div class="tab" id="tab-js">JavaScript</div>
        </div>
        
        <div class="main-content">
            <div class="code-panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="icon html-icon">&lt;/&gt;</div>
                        <span>HTML 编辑器</span>
                    </div>
                    <div class="realtime-control">
                        <span>实时更新:</span>
                        <label class="switch">
                            <input type="checkbox" id="realtime-toggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="code-container">
                    <textarea id="html-code" placeholder="在此输入HTML代码..."></textarea>
                </div>
            </div>
            
            <div class="code-panel" style="display: none;" id="css-panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="icon css-icon">CSS</div>
                        <span>CSS 编辑器</span>
                    </div>
                    <div class="realtime-control">
                        <span>实时更新:</span>
                        <label class="switch">
                            <input type="checkbox" id="realtime-toggle-css" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="code-container">
                    <textarea id="css-code" placeholder="在此输入CSS代码..."></textarea>
                </div>
            </div>
            
            <div class="code-panel" style="display: none;" id="js-panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <div class="icon js-icon">JS</div>
                        <span>JavaScript 编辑器</span>
                    </div>
                    <div class="realtime-control">
                        <span>实时更新:</span>
                        <label class="switch">
                            <input type="checkbox" id="realtime-toggle-js" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="code-container">
                    <textarea id="js-code" placeholder="在此输入JavaScript代码..."></textarea>
                </div>
            </div>
            
            <div class="preview-panel">
                <div class="preview-header">
                    <div class="panel-title">
                        <div class="icon preview-icon">▶</div>
                        <span>实时预览</span>
                    </div>
                    <div class="preview-controls">
                        <button class="btn btn-primary" id="refresh-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                                <path d="M8 4.466V.534a.5.5 0 0 1 .04-.182l1.2-3a.5.5 0 0 1 .336-.316l5-1a.5.5 0 0 1 .558.316l1.2 3A.5.5 0 0 1 15.466 4H.534a.5.5 0 0 1-.182-.04l-1.2-3a.5.5 0 0 1 .316-.336l5-1a.5.5 0 0 1 .558.316l1.2 3A.5.5 0 0 1 8.466.534V4.466z"/>
                            </svg>
                            刷新预览
                        </button>
                    </div>
                </div>
                <div class="preview-content" id="preview-frame">
                    <!-- 预览内容将通过JavaScript动态加载 -->
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; font-size: 1.2rem;">
                        <div style="text-align: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" viewBox="0 0 16 16" style="margin-bottom: 15px; color: #ccc;">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                            </svg>
                            <p>请在左侧输入HTML代码，然后点击"刷新预览"按钮查看结果</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="controls-panel">
            <h2 class="controls-title">控制面板</h2>
            <div class="controls">
                <button class="btn btn-primary" id="run-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="M6.271 5.055a.5.5 0 0 1 .52.038l3.5 2.5a.5.5 0 0 1 0 .814l-3.5 2.5A.5.5 0 0 1 6 10.5v-5a.5.5 0 0 1 .271-.445z"/>
                    </svg>
                    运行代码
                </button>
                <button class="btn btn-secondary" id="save-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z"/>
                    </svg>
                    保存代码
                </button>
                <button class="btn btn-success" id="load-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                    </svg>
                    加载代码
                </button>
                <button class="btn btn-danger" id="reset-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .04-.182l1.2-3a.5.5 0 0 1 .336-.316l5-1a.5.5 0 0 1 .558.316l1.2 3A.5.5 0 0 1 15.466 4H.534a.5.5 0 0 1-.182-.04l-1.2-3a.5.5 0 0 1 .316-.336l5-1a.5.5 0 0 1 .558.316l1.2 3A.5.5 0 0 1 8.466.534V4.466z"/>
                    </svg>
                    重置所有
                </button>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" id="toggle-all-realtime" style="background: linear-gradient(90deg, #9C27B0, #673AB7); color: white;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 7a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/>
                        <path d="M16 8c0 3.15-1.866 2.585-3.567 2.07C11.42 9.763 10.465 9.473 10 10c-.603.683-.475 1.819-.351 2.92C9.826 14.495 9.996 16 8 16a8 8 0 1 1 8-8zm-8 7c.611 0 .654-.171.655-.176.078-.146.124-.464.07-1.119-.014-.168-.037-.37-.061-.591-.052-.464-.112-1.005-.118-1.462-.01-.707.083-1.61.704-2.314.369-.417.845-.578 1.272-.618.404-.038.812.026 1.16.104.343.077.702.186 1.025.284l.028.008c.346.105.658.199.953.266.653.148.904.083.991.024C14.717 9.38 15 9.161 15 8a7 7 0 1 0-7 7z"/>
                    </svg>
                    切换所有实时更新
                </button>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator" id="realtime-status-indicator"></div>
                <span>实时更新状态: <strong id="realtime-status-text">已启用</strong></span>
            </div>
            <div class="status-item">
                <span>最后更新: <span id="last-update">从未</span></span>
            </div>
            <div class="status-item">
                <span>代码行数: <span id="code-lines">0</span></span>
            </div>
        </div>
        
        <footer>
            <p>HTML预览器 &copy; 2023 | 使用CodeMirror构建 | 支持HTML5, CSS3, ES6+</p>
        </footer>
    </div>

    <!-- 引入CodeMirror库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/htmlmixed/htmlmixed.min.js"></script>
    
    <script>
        // 初始化变量
        let htmlEditor, cssEditor, jsEditor;
        let lastUpdateTime = null;
        let currentTab = 'html';
        let realtimeEnabled = true;
        let updateTimeout = null;
        
        // 初始化CodeMirror编辑器
        document.addEventListener('DOMContentLoaded', function() {
            // HTML编辑器
            htmlEditor = CodeMirror.fromTextArea(document.getElementById('html-code'), {
                mode: 'htmlmixed',
                theme: 'dracula',
                lineNumbers: true,
                autoCloseTags: true,
                lineWrapping: true,
                tabSize: 2
            });
            
            // CSS编辑器
            cssEditor = CodeMirror.fromTextArea(document.getElementById('css-code'), {
                mode: 'css',
                theme: 'dracula',
                lineNumbers: true,
                lineWrapping: true,
                tabSize: 2
            });
            
            // JavaScript编辑器
            jsEditor = CodeMirror.fromTextArea(document.getElementById('js-code'), {
                mode: 'javascript',
                theme: 'dracula',
                lineNumbers: true,
                lineWrapping: true,
                tabSize: 2
            });
            
            // 设置编辑器变化监听（带防抖）
            htmlEditor.on('change', function() {
                if (realtimeEnabled && document.getElementById('realtime-toggle').checked) {
                    clearTimeout(updateTimeout);
                    updateTimeout = setTimeout(updatePreview, 500);
                }
            });
            
            cssEditor.on('change', function() {
                if (realtimeEnabled && document.getElementById('realtime-toggle-css').checked) {
                    clearTimeout(updateTimeout);
                    updateTimeout = setTimeout(updatePreview, 500);
                }
            });
            
            jsEditor.on('change', function() {
                if (realtimeEnabled && document.getElementById('realtime-toggle-js').checked) {
                    clearTimeout(updateTimeout);
                    updateTimeout = setTimeout(updatePreview, 500);
                }
            });
            
            // 设置标签页切换
            setupTabs();
            
            // 设置按钮事件
            document.getElementById('run-btn').addEventListener('click', updatePreview);
            document.getElementById('refresh-btn').addEventListener('click', updatePreview);
            document.getElementById('save-btn').addEventListener('click', saveCode);
            document.getElementById('load-btn').addEventListener('click', loadCode);
            document.getElementById('reset-btn').addEventListener('click', resetCode);
            document.getElementById('toggle-all-realtime').addEventListener('click', toggleAllRealtime);
            
            // 实时更新开关事件
            document.getElementById('realtime-toggle').addEventListener('change', updateRealtimeStatus);
            document.getElementById('realtime-toggle-css').addEventListener('change', updateRealtimeStatus);
            document.getElementById('realtime-toggle-js').addEventListener('change', updateRealtimeStatus);
            
            // 初始化状态
            updateRealtimeStatus();
            updateCodeLines();
            
            // 加载示例代码
            loadExampleCode();
        });
        
        // 更新预览
        function updatePreview() {
            const html = htmlEditor.getValue();
            const css = cssEditor.getValue();
            const js = jsEditor.getValue();
            
            // 如果所有编辑器都为空，显示提示
            if (!html.trim() && !css.trim() && !js.trim()) {
                const previewFrame = document.getElementById('preview-frame');
                previewFrame.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; font-size: 1.2rem;">
                        <div style="text-align: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" viewBox="0 0 16 16" style="margin-bottom: 15px; color: #ccc;">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                            </svg>
                            <p>请在左侧输入HTML代码，然后点击"刷新预览"按钮查看结果</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            // 构建预览文档
            const preview = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <style>${css}</style>
                </head>
                <body>
                    ${html}
                    <script>${js}<\/script>
                </body>
                </html>
            `;
            
            // 更新预览iframe
            const previewFrame = document.getElementById('preview-frame');
            previewFrame.innerHTML = '';
            
            const iframe = document.createElement('iframe');
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            iframe.style.border = 'none';
            iframe.srcdoc = preview;
            previewFrame.appendChild(iframe);
            
            // 更新状态
            lastUpdateTime = new Date();
            document.getElementById('last-update').textContent = formatTime(lastUpdateTime);
            updateCodeLines();
        }
        
        // 设置标签页切换
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            const htmlPanel = document.querySelector('.code-panel');
            const cssPanel = document.getElementById('css-panel');
            const jsPanel = document.getElementById('js-panel');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.id.replace('tab-', '');
                    
                    // 更新活动标签
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 显示对应的编辑器
                    htmlPanel.style.display = 'none';
                    cssPanel.style.display = 'none';
                    jsPanel.style.display = 'none';
                    
                    if (tabId === 'html') {
                        htmlPanel.style.display = 'block';
                        currentTab = 'html';
                    } else if (tabId === 'css') {
                        cssPanel.style.display = 'block';
                        currentTab = 'css';
                    } else if (tabId === 'js') {
                        jsPanel.style.display = 'block';
                        currentTab = 'js';
                    }
                });
            });
        }
        
        // 保存代码到本地存储
        function saveCode() {
            const codeData = {
                html: htmlEditor.getValue(),
                css: cssEditor.getValue(),
                js: jsEditor.getValue(),
                realtime: {
                    html: document.getElementById('realtime-toggle').checked,
                    css: document.getElementById('realtime-toggle-css').checked,
                    js: document.getElementById('realtime-toggle-js').checked
                },
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('htmlPreviewerCode', JSON.stringify(codeData));
            
            // 显示保存成功消息
            alert('代码已保存到本地存储！');
            console.log('代码已保存:', codeData);
        }
        
        // 从本地存储加载代码
        function loadCode() {
            const savedData = localStorage.getItem('htmlPreviewerCode');
            
            if (savedData) {
                try {
                    const codeData = JSON.parse(savedData);
                    htmlEditor.setValue(codeData.html || '');
                    cssEditor.setValue(codeData.css || '');
                    jsEditor.setValue(codeData.js || '');
                    
                    // 恢复实时更新设置
                    if (codeData.realtime) {
                        document.getElementById('realtime-toggle').checked = codeData.realtime.html !== false;
                        document.getElementById('realtime-toggle-css').checked = codeData.realtime.css !== false;
                        document.getElementById('realtime-toggle-js').checked = codeData.realtime.js !== false;
                        updateRealtimeStatus();
                    }
                    
                    updatePreview();
                    alert('代码已从本地存储加载！');
                } catch (e) {
                    alert('加载代码时出错：' + e.message);
                }
            } else {
                alert('没有找到已保存的代码。');
            }
        }
        
        // 重置所有代码
        function resetCode() {
            if (confirm('确定要重置所有代码吗？这将清除所有编辑器的内容。')) {
                htmlEditor.setValue('');
                cssEditor.setValue('');
                jsEditor.setValue('');
                
                updatePreview();
            }
        }
        
        // 切换所有实时更新
        function toggleAllRealtime() {
            const htmlToggle = document.getElementById('realtime-toggle');
            const cssToggle = document.getElementById('realtime-toggle-css');
            const jsToggle = document.getElementById('realtime-toggle-js');
            
            // 如果至少有一个是开启的，则全部关闭，否则全部开启
            const anyEnabled = htmlToggle.checked || cssToggle.checked || jsToggle.checked;
            
            htmlToggle.checked = !anyEnabled;
            cssToggle.checked = !anyEnabled;
            jsToggle.checked = !anyEnabled;
            
            updateRealtimeStatus();
        }
        
        // 更新实时更新状态显示
        function updateRealtimeStatus() {
            const htmlToggle = document.getElementById('realtime-toggle');
            const cssToggle = document.getElementById('realtime-toggle-css');
            const jsToggle = document.getElementById('realtime-toggle-js');
            
            // 检查是否有任何实时更新被启用
            const anyRealtimeEnabled = htmlToggle.checked || cssToggle.checked || jsToggle.checked;
            
            const indicator = document.getElementById('realtime-status-indicator');
            const statusText = document.getElementById('realtime-status-text');
            
            if (anyRealtimeEnabled) {
                indicator.className = 'status-indicator active';
                statusText.textContent = '已启用';
                realtimeEnabled = true;
            } else {
                indicator.className = 'status-indicator inactive';
                statusText.textContent = '已禁用';
                realtimeEnabled = false;
            }
        }
        
        // 加载示例代码
        function loadExampleCode() {
            const exampleHTML = `<!DOCTYPE html>
<html>
<head>
    <title>示例页面</title>
</head>
<body>
    <div class="container">
        <h1>欢迎使用HTML预览器</h1>
        <p>这是一个实时HTML预览工具。在左侧编辑代码，右侧将显示预览结果。</p>
        
        <div class="demo-card">
            <h2>功能特性</h2>
            <ul>
                <li>实时预览HTML、CSS和JavaScript</li>
                <li>可控制实时更新开关</li>
                <li>代码编辑器支持语法高亮</li>
                <li>保存和加载代码功能</li>
            </ul>
            
            <button id="demo-button">点击我试试</button>
            <p id="demo-output">等待交互...</p>
        </div>
        
        <div class="color-boxes">
            <div class="box" style="background-color: #3498db;"></div>
            <div class="box" style="background-color: #2ecc71;"></div>
            <div class="box" style="background-color: #e74c3c;"></div>
            <div class="box" style="background-color: #f39c12;"></div>
        </div>
    </div>
</body>
</html>`;
            
            const exampleCSS = `body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #f9f9f9;
    margin: 0;
    padding: 20px;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
}

h1 {
    color: #2c3e50;
    border-bottom: 3px solid #3498db;
    padding-bottom: 10px;
    margin-bottom: 20px;
}

.demo-card {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    border-radius: 10px;
    padding: 20px;
    margin: 25px 0;
    border-left: 5px solid #3498db;
}

button {
    background: #3498db;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.3s;
    margin-top: 15px;
}

button:hover {
    background: #2980b9;
}

.color-boxes {
    display: flex;
    gap: 15px;
    margin-top: 30px;
}

.box {
    width: 80px;
    height: 80px;
    border-radius: 10px;
    transition: transform 0.3s;
}

.box:hover {
    transform: scale(1.1);
}`;
            
            const exampleJS = `document.addEventListener('DOMContentLoaded', function() {
    const demoButton = document.getElementById('demo-button');
    const demoOutput = document.getElementById('demo-output');
    
    demoButton.addEventListener('click', function() {
        const messages = [
            "你好！欢迎使用HTML预览器。",
            "实时更新功能可以手动开启或关闭。",
            "点击颜色方块可以改变背景色。",
            "试试修改左侧的代码看看效果！"
        ];
        
        const randomIndex = Math.floor(Math.random() * messages.length);
        demoOutput.textContent = messages[randomIndex];
        
        demoButton.style.background = "#2ecc71";
        setTimeout(() => {
            demoButton.style.background = "#3498db";
        }, 300);
    });
    
    const boxes = document.querySelectorAll('.box');
    boxes.forEach(box => {
        box.addEventListener('click', function() {
            const color = this.style.backgroundColor;
            document.body.style.backgroundColor = color;
            setTimeout(() => {
                document.body.style.backgroundColor = '';
            }, 1000);
        });
    });
});`;
            
            // 询问用户是否加载示例代码
            if (confirm('是否加载示例代码？点击"取消"将使用空白编辑器。')) {
                htmlEditor.setValue(exampleHTML);
                cssEditor.setValue(exampleCSS);
                jsEditor.setValue(exampleJS);
                updatePreview();
            }
        }
        
        // 更新代码行数统计
        function updateCodeLines() {
            const htmlLines = htmlEditor.getValue().split('\n').length;
            const cssLines = cssEditor.getValue().split('\n').length;
            const jsLines = jsEditor.getValue().split('\n').length;
            const totalLines = htmlLines + cssLines + jsLines;
            
            document.getElementById('code-lines').textContent = totalLines;
        }
        
        // 格式化时间显示
        function formatTime(date) {
            if (!date) return '从未';
            
            const now = new Date();
            const diff = now - date;
            
            if (diff < 10000) return '刚刚';
            if (diff < 60000) return `${Math.floor(diff / 1000)}秒前`;
            if (diff < 3600000) return `${Math.floor(diff / 60000)}分钟前`;
            
            return date.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
        }
    </script>
</body>
</html>